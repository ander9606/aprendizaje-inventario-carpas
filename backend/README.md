# üöÄ API REST - Sistema de Inventario de Carpas

API RESTful desarrollada con Node.js y Express para gestionar inventario de elementos de alquiler con **dos sistemas complementarios**: n√∫meros de serie individuales y lotes por cantidad.

---

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Tecnolog√≠as](#Ô∏è-tecnolog√≠as)
- [Requisitos](#-requisitos)
- [Instalaci√≥n](#-instalaci√≥n)
- [Configuraci√≥n](#Ô∏è-configuraci√≥n)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Concepto: Series vs Lotes](#-concepto-series-vs-lotes)
- [Endpoints](#-endpoints)
  - [Categor√≠as](#-categor√≠as)
  - [Elementos](#-elementos)
  - [Series](#Ô∏è-series)
  - [Lotes](#-lotes)
  - [Materiales](#-materiales)
  - [Unidades](#-unidades)
- [Ejemplos de Uso](#-ejemplos-de-uso)
- [C√≥digos de Estado](#-c√≥digos-de-estado)

---

## ‚ú® Caracter√≠sticas

- ‚úÖ **Arquitectura MVC** (Model-View-Controller)
- ‚úÖ **CRUD completo** para todos los recursos
- ‚úÖ **Dos sistemas de inventario:**
  - **Series individuales** (tracking exacto por n√∫mero de serie)
  - **Lotes por cantidad** (tracking grupal con estados)
- ‚úÖ **Gesti√≥n autom√°tica de lotes:**
  - Creaci√≥n din√°mica seg√∫n necesidad
  - Consolidaci√≥n autom√°tica
  - Eliminaci√≥n de lotes vac√≠os
- ‚úÖ **Historial completo** de movimientos
- ‚úÖ **Relaciones entre tablas** con JOINs
- ‚úÖ **Validaciones** de negocio robustas
- ‚úÖ **Manejo de errores** profesional
- ‚úÖ **Respuestas JSON** estandarizadas

---

## üõ†Ô∏è Tecnolog√≠as

| Tecnolog√≠a | Versi√≥n | Uso |
|-----------|---------|-----|
| Node.js | 18+ | Runtime de JavaScript |
| Express | 4.19+ | Framework web |
| MySQL | 8.0+ | Base de datos relacional |
| mysql2 | 3.11+ | Driver de MySQL con Promises |
| cors | 2.8+ | Middleware CORS |
| dotenv | 16.4+ | Variables de entorno |

---

## üì¶ Requisitos

- [Node.js](https://nodejs.org/) v18 o superior
- [MySQL](https://www.mysql.com/) v8.0 o superior
- [Git](https://git-scm.com/)

---

## üöÄ Instalaci√≥n

### 1. Clonar el repositorio
```bash
git clone https://github.com/TU-USUARIO/aprendizaje-inventario-carpas.git
cd aprendizaje-inventario-carpas/backend
```

### 2. Instalar dependencias
```bash
npm install
```

### 3. Crear base de datos
```bash
# Desde la ra√≠z del proyecto
mysql -u root -p < sql/00_SCHEMA_COMPLETO.sql
```

### 4. Configurar variables de entorno

Crea un archivo `.env` en la carpeta `backend/`:
```env
# Base de datos
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=tu_contrase√±a
DB_NAME=aprendizaje_inventario

# Servidor
PORT=3000
```

### 5. Iniciar servidor
```bash
npm start
# o en modo desarrollo:
node server.js
```

El servidor estar√° disponible en: `http://localhost:3000`

---

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno

| Variable | Descripci√≥n | Valor por Defecto |
|----------|-------------|-------------------|
| `DB_HOST` | Host de MySQL | `localhost` |
| `DB_USER` | Usuario de MySQL | `root` |
| `DB_PASSWORD` | Contrase√±a de MySQL | (vac√≠o) |
| `DB_NAME` | Nombre de la base de datos | `aprendizaje_inventario` |
| `PORT` | Puerto del servidor | `3000` |

---

## üìÅ Estructura del Proyecto
```
backend/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.js           # Configuraci√≥n de MySQL
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ categoriaController.js
‚îÇ   ‚îú‚îÄ‚îÄ elementoController.js
‚îÇ   ‚îú‚îÄ‚îÄ serieController.js
‚îÇ   ‚îú‚îÄ‚îÄ loteController.js     # L√≥gica de lotes y movimientos
‚îÇ   ‚îú‚îÄ‚îÄ materialController.js
‚îÇ   ‚îî‚îÄ‚îÄ unidadController.js
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaModel.js
‚îÇ   ‚îú‚îÄ‚îÄ ElementoModel.js
‚îÇ   ‚îú‚îÄ‚îÄ SerieModel.js
‚îÇ   ‚îú‚îÄ‚îÄ LoteModel.js          # Consultas SQL de lotes
‚îÇ   ‚îú‚îÄ‚îÄ MaterialModel.js
‚îÇ   ‚îî‚îÄ‚îÄ UnidadModel.js
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ categorias.js
‚îÇ   ‚îú‚îÄ‚îÄ elementos.js
‚îÇ   ‚îú‚îÄ‚îÄ series.js
‚îÇ   ‚îú‚îÄ‚îÄ lotes.js              # Rutas de lotes
‚îÇ   ‚îú‚îÄ‚îÄ materiales.js
‚îÇ   ‚îî‚îÄ‚îÄ unidades.js
‚îú‚îÄ‚îÄ .env                      # Variables de entorno
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ server.js                 # Punto de entrada
```

---

## üí° Concepto: Series vs Lotes

Este sistema maneja inventario con **dos enfoques complementarios**:

### üè∑Ô∏è **Sistema de SERIES** (Elementos con `requiere_series = TRUE`)

**Para elementos √∫nicos o de alto valor que necesitan tracking individual.**
```
Elemento: Carpa 10x10 Premium
  requiere_series: TRUE
  
Series (tabla series):
‚îú‚îÄ‚îÄ C10X10-001: estado=bueno, ubicacion=Bodega A
‚îú‚îÄ‚îÄ C10X10-002: estado=bueno, ubicacion=Bodega A
‚îú‚îÄ‚îÄ C10X10-003: estado=alquilado, ubicacion=NULL
‚îú‚îÄ‚îÄ C10X10-004: estado=mantenimiento, ubicacion=Taller
‚îî‚îÄ‚îÄ C10X10-005: estado=bueno, ubicacion=Bodega A

‚úÖ Tracking exacto
‚úÖ Sabes CU√ÅL carpa espec√≠fica est√° alquilada
‚úÖ Historial individual
```

**Ejemplos:** Carpas, Proyectores, Equipos de sonido, Tarimas

---

### üì¶ **Sistema de LOTES** (Elementos con `requiere_series = FALSE`)

**Para elementos consumibles o de bajo valor que se manejan por cantidad.**
```
Elemento: Reatas de tensi√≥n
  requiere_series: FALSE
  
Lotes (tabla lotes - creaci√≥n din√°mica):
‚îú‚îÄ‚îÄ Lote 1: 70 reatas (bueno, Bodega A)
‚îú‚îÄ‚îÄ Lote 2: 30 reatas (alquilado, NULL)
‚îî‚îÄ‚îÄ Lote 3: 10 reatas (mantenimiento, Taller)

‚úÖ Tracking por cantidad
‚úÖ Sabes CU√ÅNTAS reatas alquiladas
‚úÖ Lotes se crean/eliminan autom√°ticamente
‚úÖ Consolidaci√≥n autom√°tica
```

**Ejemplos:** Reatas, Estacas, Tornillos, Cuerdas, Tubos

---

### üîÑ **Diferencias Clave**

| Aspecto | Series | Lotes |
|---------|--------|-------|
| **Granularidad** | Individual | Por cantidad |
| **Identificaci√≥n** | N√∫mero √∫nico | Estado + Ubicaci√≥n |
| **Cambio de estado** | Por serie | Por movimiento de cantidad |
| **Tracking** | Exacto (sabes cu√°l) | Aproximado (sabes cu√°ntas) |
| **Complejidad** | Alta | Media |
| **Uso** | Elementos √∫nicos | Elementos consumibles |

---

## üì° Endpoints

### URL Base
```
http://localhost:3000/api
```

### Formato de Respuesta

**Respuesta Exitosa:**
```json
{
  "success": true,
  "data": [...],
  "total": 10,
  "mensaje": "Operaci√≥n exitosa"
}
```

**Respuesta de Error:**
```json
{
  "success": false,
  "mensaje": "Descripci√≥n del error",
  "error": "Detalles t√©cnicos"
}
```

---

## üìÇ Categor√≠as

Gesti√≥n de categor√≠as y subcategor√≠as (jerarqu√≠a ilimitada).

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/categorias` | Obtener todas |
| GET | `/api/categorias/padres` | Solo categor√≠as ra√≠z |
| GET | `/api/categorias/:id` | Obtener por ID |
| GET | `/api/categorias/:id/hijas` | Subcategor√≠as de una categor√≠a |
| POST | `/api/categorias` | Crear nueva |
| PUT | `/api/categorias/:id` | Actualizar |
| DELETE | `/api/categorias/:id` | Eliminar |

---

## üì¶ Elementos

Gesti√≥n de elementos del inventario.

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/elementos` | Obtener todos |
| GET | `/api/elementos/con-series` | Solo elementos con series |
| GET | `/api/elementos/sin-series` | Solo elementos con lotes |
| GET | `/api/elementos/buscar?q=termino` | Buscar elementos |
| GET | `/api/elementos/:id` | Obtener por ID |
| POST | `/api/elementos` | Crear nuevo |
| PUT | `/api/elementos/:id` | Actualizar |
| DELETE | `/api/elementos/:id` | Eliminar |

---

## üè∑Ô∏è Series

Gesti√≥n de n√∫meros de serie individuales.

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/series` | Obtener todas |
| GET | `/api/series/disponibles` | Series en estado "bueno" |
| GET | `/api/series/alquiladas` | Series en estado "alquilado" |
| GET | `/api/series/estado/:estado` | Series por estado |
| GET | `/api/series/elemento/:elementoId` | Series de un elemento |
| GET | `/api/series/numero/:numeroSerie` | Buscar por n√∫mero |
| GET | `/api/series/:id` | Obtener por ID |
| POST | `/api/series` | Crear nueva |
| PUT | `/api/series/:id` | Actualizar |
| PATCH | `/api/series/:id/estado` | Cambiar solo el estado |
| DELETE | `/api/series/:id` | Eliminar |

### Ejemplo: Cambiar estado de serie
```bash
PATCH /api/series/1/estado
```

**Body:**
```json
{
  "estado": "alquilado",
  "ubicacion": null
}
```

---

## üìä Lotes

Gesti√≥n de lotes para elementos sin series.

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/lotes` | Obtener todos los lotes |
| GET | `/api/lotes/resumen` | **Resumen de disponibilidad** |
| GET | `/api/lotes/estado/:estado` | Lotes por estado |
| GET | `/api/lotes/elemento/:elementoId` | Lotes de un elemento |
| GET | `/api/lotes/:id` | Obtener por ID |
| GET | `/api/lotes/:id/historial` | **Historial de movimientos** |
| POST | `/api/lotes` | Crear lote manualmente |
| POST | `/api/lotes/movimiento` | **‚≠ê Mover cantidad (principal)** |
| PUT | `/api/lotes/:id` | Actualizar lote |
| DELETE | `/api/lotes/:id` | Eliminar lote vac√≠o |

---

### üìä GET `/api/lotes/resumen` - Resumen de Disponibilidad

Obtiene un resumen de la disponibilidad de todos los elementos sin series.

**Respuesta:**
```json
{
  "success": true,
  "data": [
    {
      "id": 6,
      "elemento": "Reatas de tensi√≥n",
      "cantidad_total": 0,
      "disponibles": 70,
      "alquilados": 30,
      "en_mantenimiento": 0
    },
    {
      "id": 7,
      "elemento": "Estacas met√°licas",
      "cantidad_total": 0,
      "disponibles": 0,
      "alquilados": 0,
      "en_mantenimiento": 0
    }
  ],
  "total": 7
}
```

---

### üìä GET `/api/lotes/elemento/:elementoId` - Lotes de un Elemento

Obtiene todos los lotes de un elemento espec√≠fico con estad√≠sticas.

**Ejemplo:**
```
GET /api/lotes/elemento/6
```

**Respuesta:**
```json
{
  "success": true,
  "elemento": {
    "id": 6,
    "nombre": "Reatas de tensi√≥n",
    "cantidad_total": 0
  },
  "estadisticas": {
    "total": 100,
    "disponibles": 70,
    "nuevos": 0,
    "alquilados": 30,
    "en_mantenimiento": 0,
    "da√±ados": 0
  },
  "lotes": [
    {
      "id": 1,
      "lote_numero": "REATAS-2025-001",
      "cantidad": 70,
      "estado": "bueno",
      "ubicacion": "Bodega A",
      "created_at": "2025-10-15T..."
    },
    {
      "id": 6,
      "lote_numero": "LOTE-1729012345",
      "cantidad": 30,
      "estado": "alquilado",
      "ubicacion": null,
      "created_at": "2025-10-15T..."
    }
  ],
  "total_lotes": 2
}
```

---

### ‚≠ê POST `/api/lotes/movimiento` - Mover Cantidad (Funci√≥n Principal)

**Este es el endpoint m√°s importante del sistema de lotes.**

Mueve una cantidad de un lote a otro estado/ubicaci√≥n. El sistema autom√°ticamente:
- ‚úÖ Busca si existe un lote con el estado/ubicaci√≥n destino
- ‚úÖ Si existe: suma la cantidad (consolidaci√≥n)
- ‚úÖ Si no existe: crea un nuevo lote
- ‚úÖ Resta la cantidad del lote origen
- ‚úÖ Registra el movimiento en el historial
- ‚úÖ Elimina el lote origen si queda vac√≠o

**Body:**
```json
{
  "lote_origen_id": 1,
  "cantidad": 30,
  "estado_destino": "alquilado",
  "ubicacion_destino": null,
  "motivo": "alquiler",
  "descripcion": "Cliente ABC - Evento Boda - Parque Central",
  "costo_reparacion": null
}
```

**Par√°metros:**

| Campo | Tipo | Requerido | Descripci√≥n |
|-------|------|-----------|-------------|
| `lote_origen_id` | number | ‚úÖ S√≠ | ID del lote de donde se mueve |
| `cantidad` | number | ‚úÖ S√≠ | Cantidad a mover (debe ser > 0) |
| `estado_destino` | string | ‚úÖ S√≠ | Estado destino (`nuevo`, `bueno`, `mantenimiento`, `alquilado`, `da√±ado`) |
| `ubicacion_destino` | string | No | Ubicaci√≥n destino (puede ser `null`) |
| `motivo` | string | No | Motivo del movimiento (`alquiler`, `devolucion`, `limpieza`, etc.) |
| `descripcion` | string | No | Descripci√≥n detallada |
| `costo_reparacion` | number | No | Costo de reparaci√≥n (si aplica) |

**Respuesta:**
```json
{
  "success": true,
  "mensaje": "Movimiento realizado exitosamente",
  "movimiento": {
    "cantidad_movida": 30,
    "estado_origen": "bueno",
    "estado_destino": "alquilado",
    "lote_origen_eliminado": false,
    "lote_destino_creado": true
  },
  "estadisticas": {
    "total": 100,
    "disponibles": 70,
    "nuevos": 0,
    "alquilados": 30,
    "en_mantenimiento": 0,
    "da√±ados": 0
  },
  "lotes_actuales": [
    {
      "id": 1,
      "cantidad": 70,
      "estado": "bueno",
      "ubicacion": "Bodega A"
    },
    {
      "id": 6,
      "cantidad": 30,
      "estado": "alquilado",
      "ubicacion": null
    }
  ]
}
```

---

### üìú GET `/api/lotes/:id/historial` - Historial de Movimientos

Obtiene el historial completo de movimientos de un lote.

**Ejemplo:**
```
GET /api/lotes/1/historial
```

**Respuesta:**
```json
{
  "success": true,
  "lote": {
    "id": 1,
    "elemento": "Reatas de tensi√≥n",
    "cantidad_actual": 70,
    "estado": "bueno"
  },
  "historial": [
    {
      "id": 2,
      "lote_origen_id": 1,
      "lote_destino_id": 6,
      "cantidad": 20,
      "motivo": "alquiler",
      "descripcion": "Cliente XYZ - Evento Corporativo",
      "estado_origen": "bueno",
      "estado_destino": "alquilado",
      "ubicacion_origen": "Bodega A",
      "ubicacion_destino": null,
      "fecha_movimiento": "2025-10-15T14:30:00.000Z"
    },
    {
      "id": 1,
      "lote_origen_id": 1,
      "lote_destino_id": 6,
      "cantidad": 30,
      "motivo": "alquiler",
      "descripcion": "Cliente ABC - Evento Boda",
      "estado_origen": "bueno",
      "estado_destino": "alquilado",
      "fecha_movimiento": "2025-10-15T10:00:00.000Z"
    }
  ],
  "total": 2
}
```

---

## üé® Materiales

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/materiales` | Obtener todos |
| GET | `/api/materiales/mas-usados` | Materiales m√°s usados |
| GET | `/api/materiales/buscar?q=termino` | Buscar materiales |
| GET | `/api/materiales/:id` | Obtener por ID |
| POST | `/api/materiales` | Crear nuevo |
| PUT | `/api/materiales/:id` | Actualizar |
| DELETE | `/api/materiales/:id` | Eliminar |

---

## üìè Unidades

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/api/unidades` | Obtener todas |
| GET | `/api/unidades/mas-usadas` | Unidades m√°s usadas |
| GET | `/api/unidades/tipo/:tipo` | Unidades por tipo |
| GET | `/api/unidades/:id` | Obtener por ID |
| POST | `/api/unidades` | Crear nueva |
| PUT | `/api/unidades/:id` | Actualizar |
| DELETE | `/api/unidades/:id` | Eliminar |

---

## üí° Ejemplos de Uso

### üîÑ Ejemplo 1: Flujo Completo de Alquiler de Reatas
```bash
# ESTADO INICIAL
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
GET /api/lotes/elemento/6

Lotes actuales:
- Lote 1: 100 reatas (bueno, Bodega A)

# D√çA 1: Cliente alquila 30 reatas
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
POST /api/lotes/movimiento
{
  "lote_origen_id": 1,
  "cantidad": 30,
  "estado_destino": "alquilado",
  "ubicacion_destino": null,
  "motivo": "alquiler",
  "descripcion": "Cliente ABC - Boda en Parque Central"
}

Resultado:
- Lote 1: 70 reatas (bueno, Bodega A)
- Lote 2: 30 reatas (alquilado, NULL) ‚Üê CREADO AUTOM√ÅTICAMENTE

# D√çA 2: Otro cliente alquila 20 reatas
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
POST /api/lotes/movimiento
{
  "lote_origen_id": 1,
  "cantidad": 20,
  "estado_destino": "alquilado",
  "ubicacion_destino": null,
  "motivo": "alquiler",
  "descripcion": "Cliente XYZ - Evento Corporativo"
}

Resultado:
- Lote 1: 50 reatas (bueno, Bodega A)
- Lote 2: 50 reatas (alquilado, NULL) ‚Üê CONSOLIDACI√ìN: 30 + 20

# D√çA 3: Cliente ABC devuelve 30 sucias
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
POST /api/lotes/movimiento
{
  "lote_origen_id": 2,
  "cantidad": 30,
  "estado_destino": "mantenimiento",
  "ubicacion_destino": "Taller",
  "motivo": "devolucion",
  "descripcion": "Devoluci√≥n - Requieren limpieza"
}

Resultado:
- Lote 1: 50 reatas (bueno, Bodega A)
- Lote 2: 20 reatas (alquilado, NULL)
- Lote 3: 30 reatas (mantenimiento, Taller) ‚Üê CREADO

# D√çA 4: Se limpian 20 reatas
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
POST /api/lotes/movimiento
{
  "lote_origen_id": 3,
  "cantidad": 20,
  "estado_destino": "bueno",
  "ubicacion_destino": "Bodega A",
  "motivo": "limpieza",
  "descripcion": "Limpieza completada"
}

Resultado:
- Lote 1: 70 reatas (bueno, Bodega A) ‚Üê CONSOLID√ì: 50 + 20
- Lote 2: 20 reatas (alquilado, NULL)
- Lote 3: 10 reatas (mantenimiento, Taller)

# VERIFICAR HISTORIAL
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
GET /api/lotes/1/historial

Ver todos los movimientos registrados.
```

---

### üè∑Ô∏è Ejemplo 2: Gesti√≥n de Elementos con Series
```bash
# Ver carpas disponibles
GET /api/series/disponibles

# Alquilar una carpa espec√≠fica
PATCH /api/series/3/estado
{
  "estado": "alquilado",
  "ubicacion": null
}

# Ver estad√≠sticas de un elemento
GET /api/series/elemento/1

# Cuando se devuelve, mandar a mantenimiento
PATCH /api/series/3/estado
{
  "estado": "mantenimiento",
  "ubicacion": "Taller"
}

# Despu√©s de limpieza, disponible
PATCH /api/series/3/estado
{
  "estado": "bueno",
  "ubicacion": "Bodega A"
}
```

---

### üîç Ejemplo 3: Consultas de Disponibilidad
```bash
# Resumen general de elementos con lotes
GET /api/lotes/resumen

# Elementos con series disponibles
GET /api/series/disponibles

# Buscar elementos
GET /api/elementos/buscar?q=carpa

# Ver solo elementos sin series
GET /api/elementos/sin-series

# Ver categor√≠a con todos sus elementos
GET /api/elementos?categoria_id=5
```

---

## üìä C√≥digos de Estado

| C√≥digo | Significado | Uso |
|--------|-------------|-----|
| 200 | OK | Petici√≥n exitosa (GET, PUT, PATCH, DELETE) |
| 201 | Created | Recurso creado exitosamente (POST) |
| 400 | Bad Request | Datos inv√°lidos o faltantes |
| 404 | Not Found | Recurso no encontrado |
| 500 | Internal Server Error | Error del servidor |

---

## ‚ö†Ô∏è Manejo de Errores

### Validaciones Comunes

**Cantidad insuficiente:**
```json
{
  "success": false,
  "mensaje": "Cantidad insuficiente en lote origen. Disponible: 50, Solicitado: 100"
}
```

**Estado inv√°lido:**
```json
{
  "success": false,
  "mensaje": "Estado destino inv√°lido",
  "estadosValidos": ["nuevo", "bueno", "mantenimiento", "alquilado", "da√±ado"]
}
```

**Elemento requiere series:**
```json
{
  "success": false,
  "mensaje": "Este elemento requiere series individuales. Use el endpoint /api/series"
}
```

**Lote con cantidad:**
```json
{
  "success": false,
  "mensaje": "No se puede eliminar un lote con cantidad 50. Primero mueva o reduzca la cantidad a 0."
}
```

---

## üß™ Probar la API

### Con Thunder Client (VS Code)

1. Instalar extensi√≥n **Thunder Client**
2. Importar colecci√≥n (opcional)
3. Crear requests seg√∫n los ejemplos
4. Probar endpoints

### Con curl
```bash
# GET
curl http://localhost:3000/api/lotes/resumen

# POST
curl -X POST http://localhost:3000/api/lotes/movimiento \
  -H "Content-Type: application/json" \
  -d '{
    "lote_origen_id": 1,
    "cantidad": 30,
    "estado_destino": "alquilado",
    "ubicacion_destino": null,
    "motivo": "alquiler"
  }'
```

---

## üöß Notas Importantes

### Sobre Elementos y Lotes

- Un elemento con `requiere_series = TRUE` **NO puede** tener lotes
- Un elemento con `requiere_series = FALSE` **NO puede** tener series
- La decisi√≥n es a nivel de elemento y no se puede cambiar despu√©s de crear series o lotes

### Sobre Movimientos de Lotes

- Los lotes se crean **autom√°ticamente** al hacer movimientos
- Los lotes **se consolidan** si ya existe uno con mismo estado+ubicaci√≥n
- Los lotes **se eliminan** autom√°ticamente cuando quedan en cantidad 0
- Todos los movimientos se registran en `lotes_movimientos` para auditor√≠a

### Sobre Estados

**Elementos y Series:**
- `nuevo`, `bueno`, `mantenimiento`, `alquilado`, `da√±ado`, `agotado`

**Lotes:**
- `nuevo`, `bueno`, `mantenimiento`, `alquilado`, `da√±ado`

---

## üìù TODO / Futuras Mejoras

- [ ] Autenticaci√≥n y autorizaci√≥n (JWT)
- [ ] Sistema de usuarios y roles
- [ ] Paginaci√≥n en listados grandes
- [ ] Filtros avanzados por fecha
- [ ] Dashboard con estad√≠sticas
- [ ] Sistema de alquileres completo
- [ ] Notificaciones autom√°ticas
- [ ] Reportes en PDF
- [ ] Tests automatizados
- [ ] Documentaci√≥n con Swagger/OpenAPI

---

## üë®‚Äçüíª Autor

**Anderson Moreno**

---

## üìÑ Licencia

Este proyecto es de c√≥digo abierto y est√° disponible bajo la licencia MIT.

---

**√öltima actualizaci√≥n:** 15 de octubre de 2025  
**Versi√≥n:** 2.0 - Sistema completo con Lotes